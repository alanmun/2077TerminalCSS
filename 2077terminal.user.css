/* ==UserStyle==
@name           chatgpt.com
@namespace      github.com/openstyles/stylus
@version        1.0.0
@description    A new userstyle
@author         Me
==/UserStyle== */
@-moz-document url-prefix("https://chatgpt.com/") {
    :root {
        --bg-dark: oklch(0.08 0.02 141);
        --bg: var(--bg-dark);
        --bg-light: oklch(0.12 0.02 141);
        --text: oklch(0.96 0.04 141);
        --text-muted: oklch(0.76 0.04 141);
        --highlight: oklch(0.5 0.04 141);
        --border: oklch(0.4 0.04 141);
        --border-muted: oklch(0.3 0.04 141);
        --primary: oklch(0.76 0.1 141);
        --secondary: oklch(0.76 0.1 321);
        --danger: oklch(0.7 0.05 30);
        --warning: oklch(0.7 0.05 100);
        --success: oklch(0.7 0.05 160);
        --info: oklch(0.7 0.05 260);

        --font-body: "IBM Plex Mono", "Cascadia Mono", "Fira Code", "JetBrains Mono", SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
        --font-mono: "IBM Plex Mono", "Cascadia Mono", "Fira Code", "JetBrains Mono", SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;

        --radius-sm: 4px;
        --radius-md: 8px;
        --radius-lg: 12px;

        --shadow-soft: 0 0 20px oklch(0.4 0.08 141 / 0.35);
        --shadow-strong: 0 0 35px oklch(0.76 0.12 141 / 0.5);

        --border-width: 1px;
        --border-width-strong: 2px;

        --transition-fast: 120ms ease-out;
        --transition-med: 200ms ease-out;
    }

    body {
        background: var(--bg);
        color: var(--text);
        font-family: var(--font-body);
        text-rendering: geometricPrecision;
    }

    /* Ensure the composer container blends with chat background (kills default gray) */
    #thread-bottom-container,
    #thread-bottom-container *:where(.bg-token-bg-primary),
    #thread-bottom-container .bg-token-bg-primary,
    #thread-bottom-container form[data-type="unified-composer"] .bg-token-bg-primary {
        background: var(--bg-dark) !important;
        border-color: transparent !important;
        box-shadow: none !important;
    }

    /* subtle scanlines for the whole app */
    body::before {
        content: "";
        pointer-events: none;
        position: fixed;
        inset: 0;
        background-image: repeating-linear-gradient( to bottom,
        oklch(0 0 0 / 0) 0,
        oklch(0 0 0 / 0) 1px,
        oklch(0 0 0 / var(--scanline-opacity)) 2px);
        mix-blend-mode: soft-light;
        opacity: 0.9;
        z-index: 999999;
    }

    /* ------------- messages: shared typography ------------- */
    .markdown.prose {
        color: var(--text);
        font-family: var(--font-body);
        max-width: 70ch;
        line-height: 1.6;
        text-shadow: none;
    }

    .markdown.prose p {
        margin: 0.35rem 0;
    }

    .markdown.prose h1,
    .markdown.prose h2,
    .markdown.prose h3 {
        color: var(--primary);
        text-shadow: 0 0 8px color-mix(in oklch, var(--primary) 40%, black);
        margin-top: 1.2em;
        margin-bottom: 0.4em;
    }

    .markdown.prose ul,
    .markdown.prose ol {
        margin-left: 1.25rem;
        padding-left: 0.25rem;
    }

    .markdown.prose li {
        margin: 0.2rem 0;
    }

    /* inline code (NOT fenced code blocks) */
    .markdown.prose code:not([class*="language-"]) {
        font-family: var(--font-mono);
        font-size: 0.9em;
        background: color-mix(in oklch, var(--bg-light) 70%, black);
        padding: 0.05rem 0.3rem;
        border-radius: var(--radius-sm);
        border: 1px solid color-mix(in oklch, var(--border-muted) 70%, black);
    }

    /* ------------- user bubble ------------- */
    [data-message-author-role="user"] .user-message-bubble-color {
        background: color-mix(in oklch, var(--bg-light) 70%, black);
        color: var(--text);
        border-radius: 0;
        border: none;
        box-shadow: none;
        font-family: var(--font-mono);
        text-shadow: none;
        transition: transform var(--transition-fast);
    }

    [data-message-author-role="user"] .user-message-bubble-color:hover {
        box-shadow: none;
        border-color: transparent;
        transform: none;
        background: inherit;
        outline: none;
    }

    /* make user text a softer, lighter blue for dark backgrounds */
    [data-message-author-role="user"] .user-message-bubble-color .whitespace-pre-wrap {
        color: oklch(0.78 0.12 250);
        text-shadow: none;
    }

    /* ------------- assistant bubble ------------- */
    [data-message-author-role="assistant"] .markdown.prose {
        background: linear-gradient( 135deg,
        color-mix(in oklch, var(--bg) 90%, black) 0%,
        color-mix(in oklch, var(--bg-dark) 90%, black) 100%);
        border-radius: 0;
        border: none;
        color: oklch(0.66 0.15 25);
        box-shadow: none;
        padding: 1rem 1.25rem;
        margin-block: 0.4rem;
        margin-inline: 0;
        /* full width on mobile */
    }

    /* on wider viewports, keep assistant bubble slightly narrower than full width */
    @media (min-width: 900px) {
        [data-message-author-role="assistant"] .markdown.prose {
            max-width: 72ch;
            margin-inline: 0;
        }
    }

    /* remove hover backlight/outline */
    [data-message-author-role="assistant"] .markdown.prose:hover {
        border-color: transparent;
        box-shadow: none;
        background: inherit;
        outline: none;
    }

    /* ------------- assistant "thought for Xs" chip ------------- */
    .agent-turn .text-token-text-secondary:hover {
        color: var(--primary);
    }

    /* clamping this so the chip looks like a pill in your theme
     (very intentionally loose selector, but harmless) */
    .agent-turn button span .truncate {
        padding: 0.15rem 0.5rem;
        border-radius: 999px;
        background: color-mix(in oklch, var(--bg-light) 40%, transparent);
        border: 1px solid color-mix(in oklch, var(--highlight) 40%, transparent);
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.08em;
    }

    /* ------------- code blocks (assistant) ------------- */
    /* outer <pre> wrapper: remove weird overflow + normalize spacing */
    .markdown.prose pre {
        margin: 0.75rem 0;
        padding: 0;
        background: transparent;
        border-radius: var(--radius-lg);
    }

    .markdown.prose pre code {
        font-family: var(--font-mono);
        font-size: 0.9rem;
    }

    /* main code "card" container */
    .markdown.prose pre .bg-token-sidebar-surface-primary {
        background: radial-gradient( circle at top left,
        color-mix(in oklch, var(--bg-light) 50%, black) 0%,
        color-mix(in oklch, var(--bg-dark) 90%, black) 60%);
        border-radius: var(--radius-lg);
        border: var(--border-width) solid var(--border);
        box-shadow: var(--shadow-soft);
        overflow: hidden;
    }

    /* header bar that says "css", "js", etc */
    .markdown.prose pre .bg-token-sidebar-surface-primary > .flex {
        background: linear-gradient( 90deg,
        color-mix(in oklch, var(--bg-dark) 80%, black),
        color-mix(in oklch, var(--bg) 80%, black));
        border-bottom: 1px solid color-mix(in oklch, var(--border-muted) 80%, black);
        font-family: var(--font-mono);
        text-transform: uppercase;
        letter-spacing: 0.08em;
    }

    /* "copy code" pill on the right */
    .markdown.prose pre .bg-token-bg-elevated-secondary {
        background: color-mix(in oklch, var(--bg-dark) 80%, black);
        border-radius: var(--radius-sm);
        border: 1px solid color-mix(in oklch, var(--border-muted) 80%, black);
    }

    .markdown.prose pre .bg-token-bg-elevated-secondary button {
        font-family: var(--font-mono);
        text-transform: uppercase;
        letter-spacing: 0.06em;
    }

    /* code content area */
    .markdown.prose pre .overflow-y-auto {
        background: color-mix(in oklch, var(--bg-dark) 90%, black);
    }

    .markdown.prose pre .overflow-y-auto code {
        display: block;
        white-space: pre;
        text-shadow: none;
    }

    /* language-specific accent (optional; example for css/js) */
    .markdown.prose pre code.language-css {
        border-left: 2px solid var(--secondary);
        padding-left: 0.75rem;
    }

    .markdown.prose pre code.language-js {
        border-left: 2px solid var(--warning);
        padding-left: 0.75rem;
    }

    /* ------------- composer / input bar ------------- */
    form[data-type="unified-composer"] {
        border-top: none;
        margin-top: 0;
        padding-top: 0.35rem;
    }

    form[data-type="unified-composer"] .bg-token-bg-primary {
        background: color-mix(in oklch, var(--bg) 85%, black);
        border: none;
        border-radius: 0 !important;
        box-shadow: none;
        padding: 0.25rem 0.35rem;
        display: grid !important; /* changed from flex to grid for area control */
        align-items: center;
        gap: 0.5rem;
    }

    form[data-type="unified-composer"] ._prosemirror-parent_1dsxi_2,
    form[data-type="unified-composer"] .ProseMirror {
        font-family: var(--font-mono);
        color: var(--text);
        background: transparent;
        border: none;
        border-radius: 0;
        padding: 0.25rem 0.35rem;
        caret-color: transparent; /* hide thin caret */
        text-shadow: 0 0 4px color-mix(in oklch, var(--primary) 35%, transparent);
        position: relative;
        min-height: 2.5rem; /* avoid growth on focus */
        box-shadow: none;
        line-height: 1.3;
        display: flex;
        align-items: center;
    }

    /* flatten layout into flex and push + to the right */
    form[data-type="unified-composer"] [class*="grid-template-areas"] {
        display: contents !important;
    }

    /* Keep primary row as a single horizontal strip: input + leading + trailing inline */
    form[data-type="unified-composer"] .bg-token-bg-primary {
        display: grid !important;
        grid-template-areas: 'leading primary trailing' '._ footer ._' !important;
        grid-template-columns: auto 1fr auto !important;
        align-items: center !important;
        gap: 0.5rem !important;
    }

    /* Make leading/trailing sit on the same row as the input */
    form[data-type="unified-composer"] [class*="grid-area:leading"] {
        order: 0 !important;
        grid-area: leading !important;
        align-self: center !important;
    }
    form[data-type="unified-composer"] [class*="grid-area:primary"] {
        order: 1 !important;
        grid-area: primary !important;
        align-self: center !important;
    }
    form[data-type="unified-composer"] [class*="grid-area:trailing"] {
        order: 2 !important;
        grid-area: trailing !important;
        align-self: center !important;
        display: flex !important;
        gap: 0.5rem !important;
    }

    /* Prevent accidental column wrap of action buttons */
    form[data-type="unified-composer"] [class*="grid-area:trailing"] > * {
        flex: 0 0 auto !important;
    }

    /* Keep the "Thinking" pill and similar chips below in footer row */
    form[data-type="unified-composer"] [class*="grid-area:footer"] {
        grid-area: footer !important;
        width: 100% !important;
    }

    /* Avoid vertical stacking by removing forced multi-row layout when expanded */
    .group-data-expanded\/composer\:\[grid-template-areas\:\'header_header_header\'_\'primary_primary_primary\'_\'leading_footer_trailing\'\] {
        grid-template-areas: 'leading primary trailing' '._ footer ._' !important;
    }

    form[data-type="unified-composer"] [class*="grid-area:primary"] {
        order: 1;
        flex: 1;
        display: flex;
        align-items: center;
        margin: 0 !important;
        padding: 0 !important;
        min-width: 0;
    }

    form[data-type="unified-composer"] [class*="grid-area:trailing"] {
        order: 2;
        display: flex !important;
        gap: 0.5rem !important;
        align-items: center !important;
        margin: 0 !important;
        padding: 0 !important;
    }

    form[data-type="unified-composer"] [class*="grid-area:leading"] {
        order: 3;
        align-self: center;
        margin: 0 !important;
        padding: 0 !important;
    }

    /* ------------- bottom shell / thread container ------------- */
    #thread-bottom-container {
        background: var(--bg-dark) !important;
        border-top: none;
        box-shadow: none;
        padding-top: 0.15rem;
    }

    #thread-bottom,
    #thread-bottom .mx-auto,
    #thread-bottom .max-w-\(--thread-content-max-width\),
    #thread-bottom .flex {
        background: var(--bg-dark) !important;
    }

    /* blend composer with bottom shell */
    #thread-bottom-container form[data-type="unified-composer"] .bg-token-bg-primary {
        background: var(--bg-dark) !important;
        border-color: transparent !important;
        box-shadow: none !important;
        border-radius: 0 !important;
        padding: 0.15rem 0.35rem !important;
        display: grid !important;
        grid-template-areas: 'leading primary trailing' '._ footer ._' !important;
        grid-template-columns: auto 1fr auto !important;
        align-items: center !important;
        gap: 0.5rem !important;
    }

    /* hide footer disclaimer / system text in composer */
    #thread-bottom-container .text-xs,
    #thread-bottom-container [class*="text-xs"],
    #thread-bottom-container [data-testid="composer-disclaimer"] {
        display: none !important;
    }

    /* kill residual radius, shadows, gradients in grid shells */
    #thread-bottom-container .shadow-short,
    #thread-bottom-container [class*="shadow-"] {
        box-shadow: none !important;
    }

    #thread-bottom-container [class*="bg-clip-padding"],
    #thread-bottom-container [class*="bg-token-bg-primary"] {
        background-image: none !important;
    }

    /* generic CTA/btn cleanup for inline chips like "Company knowledge" */
    button.btn,
    .btn.btn-secondary {
        border-radius: 2px !important;
        border: 1px solid color-mix(in oklch, var(--border) 80%, black);
        background: var(--bg-dark) !important;
        color: var(--text) !important;
        box-shadow: inset 0 0 0 1px color-mix(in oklch, var(--border-muted) 60%, black);
        font-family: var(--font-mono);
        text-transform: uppercase;
        letter-spacing: 0.06em;
    }

    .btn .inline-flex.rounded-full {
        border-radius: 2px !important;
        background: color-mix(in oklch, var(--primary) 10%, transparent) !important;
        color: var(--primary) !important;
    }

    @keyframes terminal-caret {
        0% { opacity: 1; }
        50% { opacity: 0; }
        100% { opacity: 1; }
    }

    /* coarse TUI knobs for composer buttons */
    form[data-type="unified-composer"] .composer-btn,
    form[data-type="unified-composer"] .composer-secondary-button-color {
        border-radius: 2px !important;
        border: 1px solid color-mix(in oklch, var(--border) 80%, black);
        background: var(--bg-dark);
        color: var(--text-muted);
        box-shadow: inset 0 0 0 1px color-mix(in oklch, var(--border-muted) 60%, black);
        height: 2.4rem;
        width: 2.4rem;
        font-family: var(--font-mono);
        text-transform: uppercase;
        letter-spacing: 0.06em;
    }

    /* submit button matches knobs */
    #composer-submit-button,
    #composer-submit-button.composer-submit-btn {
        border-radius: 2px !important;
        border: 1px solid color-mix(in oklch, var(--border) 80%, black);
        background: var(--bg-dark) !important;
        color: var(--text);
        box-shadow: inset 0 0 0 1px color-mix(in oklch, var(--border-muted) 60%, black);
        height: 2.4rem !important;
        width: 2.4rem !important;
    }

    #composer-submit-button svg {
        filter: drop-shadow(0 0 4px color-mix(in oklch, var(--primary) 25%, transparent));
    }

    form[data-type="unified-composer"] .composer-btn:hover,
    form[data-type="unified-composer"] .composer-secondary-button-color:hover {
        border-color: var(--highlight);
        color: var(--primary);
        box-shadow: 0 0 12px color-mix(in oklch, var(--highlight) 40%, transparent);
    }

    form[data-type="unified-composer"] .composer-btn svg,
    form[data-type="unified-composer"] .composer-secondary-button-color svg {
        filter: drop-shadow(0 0 4px color-mix(in oklch, var(--primary) 25%, transparent));
    }

    /* Button: Chat continues below (down-arrow) — align with other knobs/buttons */
    button.cursor-pointer.absolute.z-30.bg-clip-padding.border.end-1\/2.translate-x-1\/2.bg-token-main-surface-primary.w-8.h-8.flex.items-center.justify-center.print\:hidden {
        border-radius: 2px !important;
        border: 1px solid color-mix(in oklch, var(--border) 80%, black) !important;
        background: var(--bg-dark) !important;
        color: var(--text-muted) !important;
        box-shadow: inset 0 0 0 1px color-mix(in oklch, var(--border-muted) 60%, black) !important;
    }

    /* Button: Chat continues below (down-arrow) — hover */
    button.cursor-pointer.absolute.z-30.bg-clip-padding.border.end-1\/2.translate-x-1\/2.bg-token-main-surface-primary.w-8.h-8.flex.items-center.justify-center.print\:hidden:hover {
        border-color: var(--highlight) !important;
        color: var(--primary) !important;
        box-shadow: 0 0 12px color-mix(in oklch, var(--highlight) 40%, transparent) !important;
    }

    /* Button: Chat continues below (down-arrow) — icon glow */
    button.cursor-pointer.absolute.z-30.bg-clip-padding.border.end-1\/2.translate-x-1\/2.bg-token-main-surface-primary.w-8.h-8.flex.items-center.justify-center.print\:hidden svg {
        filter: drop-shadow(0 0 4px color-mix(in oklch, var(--primary) 25%, transparent));
    }

    /* Turn action bar buttons: match TUI knob style */
    /* Button: Copy */
    button[aria-label="Copy"],
    button[data-testid="copy-turn-action-button"],
    /* Button: Good response */
    button[aria-label="Good response"],
    /* Button: Bad response */
    button[aria-label="Bad response"],
    /* Button: Share */
    button[aria-label="Share"],
    /* Button: Switch model */
    button[aria-label="Switch model"],
    /* Button: More actions */
    button[aria-label="More actions"] {
        border-radius: 2px !important;
        border: 1px solid color-mix(in oklch, var(--border) 80%, black) !important;
        background: var(--bg-dark) !important;
        color: var(--text-muted) !important;
        box-shadow: inset 0 0 0 1px color-mix(in oklch, var(--border-muted) 60%, black) !important;
    }

    /* Header: top app bar shell */
    header#page-header {
        background: linear-gradient(180deg,
            color-mix(in oklch, var(--bg-dark) 88%, black) 0%,
            color-mix(in oklch, var(--bg-dark) 96%, black) 100%) !important;
        border-bottom: 1px solid color-mix(in oklch, var(--border-muted) 70%, black) !important;
        box-shadow: 0 0 20px oklch(0 0 0 / 0.25), inset 0 -1px 0 color-mix(in oklch, var(--border) 40%, transparent) !important;
        backdrop-filter: none !important;
    }

    /* Sidebar: shell surfaces */
    nav[aria-label="Chat history"],
    nav[aria-label="Chat history"] .bg-token-bg-elevated-secondary,
    nav[aria-label="Chat history"] .sticky,
    nav[aria-label="Chat history"] aside,
    nav[aria-label="Chat history"] .group/scrollport {
        background: var(--bg-dark) !important;
        box-shadow: none !important;
    }

    /* Sidebar: scrollbar hard-rect (VS Code-like) */
    nav[aria-label="Chat history"] {
        scrollbar-width: thin;
        scrollbar-color: color-mix(in oklch, var(--border) 70%, black) transparent;
    }
    nav[aria-label="Chat history"]::-webkit-scrollbar {
        width: 10px;
        height: 10px;
    }
    nav[aria-label="Chat history"]::-webkit-scrollbar-track {
        background: transparent;
    }
    nav[aria-label="Chat history"]::-webkit-scrollbar-thumb {
        background: color-mix(in oklch, var(--border) 70%, black);
        border: 2px solid transparent; /* creates inset track gap */
        background-clip: padding-box;
        border-radius: 0;
    }

    /* Sidebar: section headers ("Projects", "Chats") */
    nav[aria-label="Chat history"] .__menu-label {
        color: var(--text-muted) !important;
        text-transform: uppercase;
        letter-spacing: 0.08em;
        text-shadow: 0 0 6px color-mix(in oklch, var(--primary) 20%, transparent);
    }

    /* Sidebar: top header row (Home + collapse) */
    #sidebar-header > a[aria-label="Home"],
    #sidebar-header button[aria-label="Close sidebar"] {
        border-radius: 0 !important;
        border: 1px solid color-mix(in oklch, var(--border) 80%, black) !important;
        background: var(--bg-dark) !important;
        color: var(--text-muted) !important;
        box-shadow: inset 0 0 0 1px color-mix(in oklch, var(--border-muted) 60%, black) !important;
    }

    #sidebar-header > a[aria-label="Home"]:hover,
    #sidebar-header button[aria-label="Close sidebar"]:hover {
        border-color: var(--highlight) !important;
        color: var(--primary) !important;
        box-shadow: 0 0 12px color-mix(in oklch, var(--highlight) 40%, transparent) !important;
    }

    #sidebar-header > a[aria-label="Home"] .icon-lg,
    #sidebar-header button[aria-label="Close sidebar"] .icon,
    #sidebar-header button[aria-label="Close sidebar"] .icon-md {
        filter: drop-shadow(0 0 4px color-mix(in oklch, var(--primary) 25%, transparent));
    }

    /* Sidebar: primary items (New chat, Search chats, Library, Codex, GPTs) */
    /* Button: New chat (sidebar) */
    a[data-testid="create-new-chat-button"].__menu-item,
    /* Button: Search chats */
    .__menu-item:has(.truncate:contains("Search chats")),
    /* Button: Library entry */
    a[data-testid="sidebar-item-library"].__menu-item,
    /* Button: Codex */
    a.__menu-item[href="/codex"],
    /* Button: GPTs */
    a[data-testid="explore-gpts-button"].__menu-item {
        border-radius: 0 !important;
        border: 1px solid color-mix(in oklch, var(--border) 80%, black) !important;
        background: var(--bg-dark) !important;
        color: var(--text) !important;
        box-shadow: inset 0 0 0 1px color-mix(in oklch, var(--border-muted) 60%, black) !important;
    }

    /* Note: :has and :contains support varies; fallback: style all root menu items */
    nav[aria-label="Chat history"] .__menu-item.hoverable {
        border-radius: 0;
    }

    /* Sidebar items hover */
    a[data-testid="create-new-chat-button"].__menu-item:hover,
    a[data-testid="sidebar-item-library"].__menu-item:hover,
    a.__menu-item[href="/codex"]:hover,
    a[data-testid="explore-gpts-button"].__menu-item:hover,
    nav[aria-label="Chat history"] .__menu-item.hoverable:hover {
        border-color: var(--highlight) !important;
        color: var(--primary) !important;
        box-shadow: 0 0 12px color-mix(in oklch, var(--highlight) 40%, transparent) !important;
    }

    /* Sidebar: icons glow for primary items */
    a[data-testid="create-new-chat-button"].__menu-item .icon svg,
    a[data-testid="sidebar-item-library"].__menu-item .icon svg,
    a.__menu-item[href="/codex"] .icon svg,
    a[data-testid="explore-gpts-button"].__menu-item .icon svg {
        filter: drop-shadow(0 0 4px color-mix(in oklch, var(--primary) 25%, transparent));
    }

    /* Sidebar: expando section header chips (Projects/Chats row) */
    .group.sidebar-expando-section .__menu-item[data-no-hover-bg="true"],
    .group\/sidebar-expando-section .__menu-item[data-no-hover-bg="true"] {
        border-radius: 0 !important;
        border: 1px solid color-mix(in oklch, var(--border-muted) 70%, black) !important;
        background: color-mix(in oklch, var(--bg) 90%, black) !important;
        color: var(--text-muted) !important;
        box-shadow: inset 0 0 0 1px color-mix(in oklch, var(--border-muted) 50%, black) !important;
    }

    /* Sidebar: Project rows and trailing kebab buttons */
    .group.sidebar-expando-section .__menu-item.hoverable,
    .group.sidebar-expando-section .__menu-item .__menu-item-trailing-btn,
    .__menu-item .__menu-item-trailing-btn,
    button[aria-label="Open conversation options"] {
        border-radius: 0 !important;
        border: 1px solid color-mix(in oklch, var(--border) 80%, black) !important;
        background: var(--bg-dark) !important;
        color: var(--text-muted) !important;
        box-shadow: inset 0 0 0 1px color-mix(in oklch, var(--border-muted) 60%, black) !important;
    }

    .group.sidebar-expando-section .__menu-item.hoverable:hover,
    .group.sidebar-expando-section .__menu-item .__menu-item-trailing-btn:hover,
    .__menu-item .__menu-item-trailing-btn:hover,
    button[aria-label="Open conversation options"]:hover {
        border-color: var(--highlight) !important;
        color: var(--primary) !important;
        box-shadow: 0 0 12px color-mix(in oklch, var(--highlight) 40%, transparent) !important;
    }

    .group.sidebar-expando-section .__menu-item.hoverable svg,
    .__menu-item .__menu-item-trailing-btn svg,
    button[aria-label="Open conversation options"] svg {
        filter: drop-shadow(0 0 4px color-mix(in oklch, var(--primary) 25%, transparent));
    }

    /* Sidebar: history items rows */
    nav[aria-label="Chat history"] #history .__menu-item.hoverable {
        border-radius: 0 !important;
        border: 1px solid color-mix(in oklch, var(--border) 80%, black) !important;
        background: var(--bg-dark) !important;
        color: var(--text) !important;
        box-shadow: inset 0 0 0 1px color-mix(in oklch, var(--border-muted) 60%, black) !important;
    }

    nav[aria-label="Chat history"] #history .__menu-item.hoverable[data-active] {
        border-color: var(--highlight) !important;
        box-shadow: 0 0 10px color-mix(in oklch, var(--highlight) 35%, transparent) !important;
        color: var(--primary) !important;
    }

    nav[aria-label="Chat history"] #history .__menu-item.hoverable:hover {
        border-color: var(--highlight) !important;
        color: var(--primary) !important;
        box-shadow: 0 0 12px color-mix(in oklch, var(--highlight) 40%, transparent) !important;
    }

    /* Sidebar: bottom profile button and CTA */
    /* Button: Open profile menu */
    [data-testid="accounts-profile-button"].__menu-item {
        border-radius: 0 !important;
        border: 1px solid color-mix(in oklch, var(--border) 80%, black) !important;
        background: var(--bg-dark) !important;
        color: var(--text) !important;
        box-shadow: inset 0 0 0 1px color-mix(in oklch, var(--border-muted) 60%, black) !important;
    }

    [data-testid="accounts-profile-button"].__menu-item:hover {
        border-color: var(--highlight) !important;
        color: var(--primary) !important;
        box-shadow: 0 0 12px color-mix(in oklch, var(--highlight) 40%, transparent) !important;
    }

    /* Button: Invite team members (bottom CTA) */
    .border-token-interactive-border-secondary-default.rounded-full.border {
        border-radius: 0 !important;
        border: 1px solid color-mix(in oklch, var(--border) 80%, black) !important;
        background: var(--bg-dark) !important;
        color: var(--text) !important;
        box-shadow: inset 0 0 0 1px color-mix(in oklch, var(--border-muted) 60%, black) !important;
    }

    .border-token-interactive-border-secondary-default.rounded-full.border:hover {
        border-color: var(--highlight) !important;
        color: var(--primary) !important;
        box-shadow: 0 0 12px color-mix(in oklch, var(--highlight) 40%, transparent) !important;
    }

    /* Button: Model selector (current model) */
    button[aria-label^="Model selector, current model is"],
    button[data-testid="model-switcher-dropdown-button"] {
        border-radius: 2px !important;
        border: 1px solid color-mix(in oklch, var(--border) 80%, black) !important;
        background: var(--bg-dark) !important;
        color: var(--text) !important;
        box-shadow: inset 0 0 0 1px color-mix(in oklch, var(--border-muted) 60%, black) !important;
    }

    /* Button: Model selector — hover/focus */
    button[aria-label^="Model selector, current model is"]:hover,
    button[data-testid="model-switcher-dropdown-button"]:hover,
    button[aria-label^="Model selector, current model is"]:focus-visible,
    button[data-testid="model-switcher-dropdown-button"]:focus-visible {
        border-color: var(--highlight) !important;
        color: var(--primary) !important;
        box-shadow: 0 0 12px color-mix(in oklch, var(--highlight) 40%, transparent) !important;
    }

    /* Button: Model selector — icon/text tint */
    button[aria-label^="Model selector, current model is"] .text-token-text-tertiary,
    button[data-testid="model-switcher-dropdown-button"] .text-token-text-tertiary,
    button[aria-label^="Model selector, current model is"] .icon-sm,
    button[data-testid="model-switcher-dropdown-button"] .icon-sm {
        color: var(--text-muted) !important;
        filter: drop-shadow(0 0 4px color-mix(in oklch, var(--primary) 20%, transparent));
    }

    /* Header actions cluster */
    #conversation-header-actions .btn,
    #conversation-header-actions button {
        border-radius: 2px !important;
    }

    /* Button: Open conversation options (kebab) */
    button[aria-label="Open conversation options"],
    [data-testid="conversation-options-button"] {
        border-radius: 2px !important;
        border: 1px solid color-mix(in oklch, var(--border) 80%, black) !important;
        background: var(--bg-dark) !important;
        color: var(--text-muted) !important;
        box-shadow: inset 0 0 0 1px color-mix(in oklch, var(--border-muted) 60%, black) !important;
    }

    /* Button: Open conversation options — hover */
    button[aria-label="Open conversation options"]:hover,
    [data-testid="conversation-options-button"]:hover {
        border-color: var(--highlight) !important;
        color: var(--primary) !important;
        box-shadow: 0 0 12px color-mix(in oklch, var(--highlight) 40%, transparent) !important;
    }

    /* Button: Open conversation options — icon glow */
    button[aria-label="Open conversation options"] svg,
    [data-testid="conversation-options-button"] svg {
        filter: drop-shadow(0 0 4px color-mix(in oklch, var(--primary) 25%, transparent));
    }

    /* Button: Copy — hover */
    button[aria-label="Copy"]:hover,
    button[data-testid="copy-turn-action-button"]:hover,
    /* Button: Good response — hover */
    button[aria-label="Good response"]:hover,
    /* Button: Bad response — hover */
    button[aria-label="Bad response"]:hover,
    /* Button: Share — hover */
    button[aria-label="Share"]:hover,
    /* Button: Switch model — hover */
    button[aria-label="Switch model"]:hover,
    /* Button: More actions — hover */
    button[aria-label="More actions"]:hover {
        border-color: var(--highlight) !important;
        color: var(--primary) !important;
        box-shadow: 0 0 12px color-mix(in oklch, var(--highlight) 40%, transparent) !important;
    }

    /* Button: Copy — icon glow */
    button[aria-label="Copy"] svg,
    button[data-testid="copy-turn-action-button"] svg,
    /* Button: Good response — icon glow */
    button[aria-label="Good response"] svg,
    /* Button: Bad response — icon glow */
    button[aria-label="Bad response"] svg,
    /* Button: Share — icon glow */
    button[aria-label="Share"] svg,
    /* Button: Switch model — icon glow */
    button[aria-label="Switch model"] svg,
    /* Button: More actions — icon glow */
    button[aria-label="More actions"] svg {
        filter: drop-shadow(0 0 4px color-mix(in oklch, var(--primary) 25%, transparent));
    }

    /* keep the primary text line vertically centered */
    form[data-type="unified-composer"] [class*="grid-template-areas"] > [class*="grid-area:primary"] {
        margin: 0 !important;
        padding: 0.15rem 0 !important;
        min-height: 2.4rem;
        display: flex;
        align-items: center;
    }

    form[data-type="unified-composer"] ._prosemirror-parent_1dsxi_2 {
        display: flex;
        align-items: center;
    }

    form[data-type="unified-composer"] .ProseMirror {
        display: inline-block;
        vertical-align: middle;
        text-align: left;
        white-space: pre-wrap;
    }

    form[data-type="unified-composer"] .ProseMirror p {
        margin: 0;
        line-height: 1.25;
    }

    /* Modal: Create project — shell */
    [role="dialog"][data-modal-layer="content"].popover {
        border-radius: 0 !important;
        background: var(--bg-dark) !important;
        border: 1px solid color-mix(in oklch, var(--border) 80%, black) !important;
        box-shadow: inset 0 0 0 1px color-mix(in oklch, var(--border-muted) 60%, black), 0 0 20px oklch(0 0 0 / 0.25) !important;
        overflow: hidden !important;
    }

    /* Modal: header */
    [role="dialog"][data-modal-layer="content"].popover > header {
        background: linear-gradient(180deg,
            color-mix(in oklch, var(--bg-dark) 88%, black) 0%,
            color-mix(in oklch, var(--bg-dark) 96%, black) 100%) !important;
        border-bottom: 1px solid color-mix(in oklch, var(--border-muted) 70%, black) !important;
        min-height: 2.75rem;
    }

    [role="dialog"][data-modal-layer="content"].popover > header h2 {
        color: var(--primary) !important;
        text-shadow: 0 0 8px color-mix(in oklch, var(--primary) 35%, black);
        font-family: var(--font-mono);
        letter-spacing: 0.02em;
    }

    /* Modal: header buttons (plus dropdown and close) */
    [role="dialog"][data-modal-layer="content"].popover > header .dropdown-btn,
    [role="dialog"][data-modal-layer="content"].popover > header [data-testid="close-button"] {
        border-radius: 0 !important;
        border: 1px solid color-mix(in oklch, var(--border) 80%, black) !important;
        background: var(--bg-dark) !important;
        color: var(--text-muted) !important;
        box-shadow: inset 0 0 0 1px color-mix(in oklch, var(--border-muted) 60%, black) !important;
        width: 2.25rem;
        height: 2.25rem;
    }

    [role="dialog"][data-modal-layer="content"].popover > header .dropdown-btn:hover,
    [role="dialog"][data-modal-layer="content"].popover > header [data-testid="close-button"]:hover {
        border-color: var(--highlight) !important;
        color: var(--primary) !important;
        box-shadow: 0 0 12px color-mix(in oklch, var(--highlight) 40%, transparent) !important;
    }

    [role="dialog"][data-modal-layer="content"].popover > header .dropdown-btn svg,
    [role="dialog"][data-modal-layer="content"].popover > header [data-testid="close-button"] svg {
        filter: drop-shadow(0 0 4px color-mix(in oklch, var(--primary) 25%, transparent));
    }

    /* Modal: name input */
    [role="dialog"][data-modal-layer="content"] #project-modal-form input[type="text"][name="projectName"] {
        border-radius: 0 !important;
        background: var(--bg-dark) !important;
        color: var(--text) !important;
        border: 1px solid color-mix(in oklch, var(--border) 80%, black) !important;
        box-shadow: inset 0 0 0 1px color-mix(in oklch, var(--border-muted) 60%, black) !important;
        font-family: var(--font-mono) !important;
        caret-color: var(--primary);
    }

    [role="dialog"][data-modal-layer="content"] #project-modal-form input[type="text"][name="projectName"]::placeholder {
        color: var(--text-muted) !important;
    }

    [role="dialog"][data-modal-layer="content"] #project-modal-form input[type="text"][name="projectName"]:focus {
        outline: none !important;
        border-color: var(--highlight) !important;
        box-shadow: 0 0 12px color-mix(in oklch, var(--highlight) 35%, transparent) !important;
    }

    /* Modal: emoji/model picker trigger next to input */
    [role="dialog"][data-modal-layer="content"] #project-modal-form [data-testid="project-modal-trigger"] {
        border-radius: 0 !important;
        border: 1px solid color-mix(in oklch, var(--border) 80%, black) !important;
        background: var(--bg-dark) !important;
        color: var(--text-muted) !important;
        box-shadow: inset 0 0 0 1px color-mix(in oklch, var(--border-muted) 60%, black) !important;
        width: 2.25rem;
        height: 2.25rem;
    }

    [role="dialog"][data-modal-layer="content"] #project-modal-form [data-testid="project-modal-trigger"]:hover {
        border-color: var(--highlight) !important;
        color: var(--primary) !important;
        box-shadow: 0 0 12px color-mix(in oklch, var(--highlight) 40%, transparent) !important;
    }

    [role="dialog"][data-modal-layer="content"] #project-modal-form [data-testid="project-modal-trigger"] svg {
        filter: drop-shadow(0 0 4px color-mix(in oklch, var(--primary) 25%, transparent));
    }

    /* Modal: info aside block */
    [role="dialog"][data-modal-layer="content"] #project-modal-form aside.bg-token-bg-tertiary {
        background: color-mix(in oklch, var(--bg-dark) 92%, black) !important;
        border-radius: 0 !important;
        border: 1px solid color-mix(in oklch, var(--border-muted) 70%, black) !important;
        box-shadow: inset 0 0 0 1px color-mix(in oklch, var(--border-muted) 50%, black) !important;
    }

    [role="dialog"][data-modal-layer="content"] #project-modal-form aside.bg-token-bg-tertiary .text-token-text-secondary {
        color: var(--text-muted) !important;
    }
}
